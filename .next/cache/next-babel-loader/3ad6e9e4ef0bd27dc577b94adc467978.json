{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React, { Component } from 'react';\nimport Header from '../components/common/Header/Header';\nimport BaseLayout from '../components/layouts/BaseLayout';\nimport BasePage from '../components/common/BasePage/BasePage';\nimport withAuth from '../components/hoc/withAuth';\nimport { Container, Row, Col } from 'reactstrap';\nimport { getUserBlogs, updateBlog, deleteBlog as _deleteBlog } from '../actions';\nimport { Link, Router } from '../routes';\nimport PortButtonDropdown from '../components/common/ButtonDropdown/ButtonDropdown';\nexport var UserBlogs =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(UserBlogs, _Component);\n\n  function UserBlogs() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, UserBlogs);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(UserBlogs)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"dropdownOptions\", function (blog) {\n      var blogStatus = _this.createStatus(blog.status);\n\n      return [{\n        text: blogStatus.view,\n        handlers: {\n          onClick: function onClick() {\n            return _this.changeBlogStatus(blogStatus.value, blog._id);\n          }\n        }\n      }, {\n        text: 'Delete',\n        handlers: {\n          onClick: function onClick() {\n            return _this.deleteBlogWarning(blog._id);\n          }\n        }\n      }];\n    });\n\n    return _this;\n  }\n\n  _createClass(UserBlogs, [{\n    key: \"changeBlogStatus\",\n    value: function changeBlogStatus(status, blogId) {\n      updateBlog({\n        status: status\n      }, blogId).then(function () {\n        Router.pushRoute('/userBlogs');\n      })[\"catch\"](function (err) {\n        console.error(err.message);\n      });\n    }\n  }, {\n    key: \"deleteBlogWarning\",\n    value: function deleteBlogWarning(blogId) {\n      var res = confirm('Are you sure you want to delete this blog post?');\n\n      if (res) {\n        this.deleteBlog(blogId);\n      }\n    }\n  }, {\n    key: \"deleteBlog\",\n    value: function deleteBlog(blogId) {\n      _deleteBlog(blogId).then(function (status) {\n        Router.pushRoute('/userBlogs');\n      })[\"catch\"](function (err) {\n        console.error(err.message);\n      });\n    }\n  }, {\n    key: \"separateBlogs\",\n    value: function separateBlogs(blogs) {\n      var published = [];\n      var drafts = [];\n      blogs.forEach(function (blog) {\n        if (blog.status === 'draft') drafts.push(blog);else published.push(blog);\n      });\n      return {\n        published: published,\n        drafts: drafts\n      };\n    }\n  }, {\n    key: \"createStatus\",\n    value: function createStatus(status) {\n      return status === 'draft' ? {\n        view: 'Publish Story',\n        value: 'published'\n      } : {\n        view: 'Make a Draft',\n        value: 'draft'\n      };\n    }\n  }, {\n    key: \"renderBlogs\",\n    value: function renderBlogs(blogs) {\n      var _this2 = this;\n\n      return __jsx(\"ul\", {\n        className: \"user-blogs-list\"\n      }, blogs.map(function (blog, index) {\n        return __jsx(\"li\", {\n          key: index\n        }, __jsx(Link, {\n          route: \"/blogs/\".concat(blog._id, \"/edit\")\n        }, __jsx(\"a\", null, blog.title)), __jsx(PortButtonDropdown, {\n          items: _this2.dropdownOptions(blog)\n        }));\n      }));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var blogs = this.props.blogs;\n\n      var _this$separateBlogs = this.separateBlogs(blogs),\n          published = _this$separateBlogs.published,\n          drafts = _this$separateBlogs.drafts;\n\n      return __jsx(BaseLayout, _extends({}, this.props.auth, {\n        headerType: 'landing'\n      }), __jsx(\"div\", {\n        className: \"masthead\",\n        style: {\n          \"backgroundImage\": \"url('../images/home-bg.jpg')\"\n        }\n      }, __jsx(\"div\", {\n        className: \"overlay\"\n      }), __jsx(Container, null, __jsx(\"div\", {\n        className: \"row\"\n      }, __jsx(\"div\", {\n        className: \"col-lg-8 col-md-10 mx-auto\"\n      }, __jsx(\"div\", {\n        className: \"site-heading\"\n      }, __jsx(\"h1\", null, \"Fresh Blogs\"), __jsx(\"span\", {\n        className: \"subheading\"\n      }, \"Programming, travelling...\")))))), __jsx(BasePage, {\n        className: \"blog-user-page\"\n      }, __jsx(Row, null, __jsx(Col, {\n        md: \"6\",\n        className: \"mx-auto text-center\"\n      }, __jsx(\"h2\", {\n        className: \"blog-status-title\"\n      }, \"Published Blogs\"), this.renderBlogs(published)), __jsx(Col, {\n        md: \"6\",\n        className: \"mx-auto text-center\"\n      }, __jsx(\"h2\", {\n        className: \"blog-status-title\"\n      }, \"Draft Blogs\"), this.renderBlogs(drafts)))));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function getInitialProps(_ref) {\n      var req, blogs;\n      return _regeneratorRuntime.async(function getInitialProps$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              req = _ref.req;\n              blogs = [];\n              _context.prev = 2;\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(getUserBlogs(req));\n\n            case 5:\n              blogs = _context.sent;\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](2);\n              console.error(_context.t0);\n\n            case 11:\n              return _context.abrupt(\"return\", {\n                blogs: blogs\n              });\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[2, 8]]);\n    }\n  }]);\n\n  return UserBlogs;\n}(Component);\nexport default withAuth('siteOwner')(UserBlogs);","map":null,"metadata":{},"sourceType":"module"}